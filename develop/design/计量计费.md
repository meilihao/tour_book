# 计量计费
1. 不要使用级联累加逻辑, 否则重跑数据时成本太高

    解决:
    - 保存最小颗粒度, 级联计算: 上级颗粒度=sum(下级颗粒度), **推荐**

      重跑:
      1. 删除重跑期间最小颗粒度的数据
      2. 保存时判断key是否存在, 存在则更新, 否则新增
      
      > 重跑时时间范围是该颗粒度的起点和终点, 避免重跑历史数据时丢失数据. 比如重跑昨天13点数据, 上级颗粒度时间范围是昨天零点到今天零点, 而不是昨天零点到昨天14点

    - ~~重跑前先级联累减, 再清理数据, 最后重跑~~, **不推荐**

        不适合级联累减逻辑复杂或不确定(即减逻辑无法准确找到需操作的级联上级)的场景
    - 逐级保留各级颗粒度数据, 比如年度数据=sum(月度数据)+sum(天数据)+sum(小时数据), 月度数据=sum(天数据)+sum(小时数据), 天数据=sum(小时数据), 且只有超过一个计量计费周期时计算上一个周期的数据, 比如3月时计算2月数据, 等于2月各天累加, **可选**