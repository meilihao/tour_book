# vmstat

显示虚拟内存状态（“Viryual Memor Statics”），但是它可以报告关于进程、内存、I/O等系统整体运行状态.
在sar命令不可用时,可使用该命令.

推荐监控间隔: 5s.

## 选项

- -a : 查看活动和非活动内存统计信息
- -d : 以每个磁盘一行的方式显示统计(包含读、写和 IO)
- -f : 开机到目前为止系统复制(fork)的进程数
- -m : 显示 slab 信息
- -p xxx : 后面跟上设备名会显示指定分区统计(包括读、读取的扇区、写以及请求的写)
- -t : 输出带有时间戳
- -s : 将一些事件(开机至目前为止)导致的内存变化情况列表说明
- -S xxx : 选择输出单位,默认是`k`,通常使用`M`

## 例

```sh
$ vmstat n m # n为监控间隔, m为监控次数. 注意: 监视间隔越小, 则结果的一致性就越差
```

## 字段说明

### procs（进程）
- r : 运行队列中的进程(正在运行+等待运行)数量. 这个值也可以判断是否需要增加CPU（长期大于系统cpu的个数）
- b : 不可中断睡眠状态(uninterruptible sleep,即阻塞等待)下的进程数,比如等待IO, 内存交换

### memory（内存）

- swpd : 使用虚拟内存大小，如果swpd的值不为0，但是SI，SO的值长期为0，这种情况不会影响系统性能
- free : 空闲物理内存大小. 实际free = free + buff + cache
- buff : 用作缓冲的内存大小
- cache : 用作缓存的内存大小，如果cache的值大的时候，说明cache处的文件数多，如果频繁访问到的文件都能被cache处，那么磁盘的读IO bi会非常小
- inact : 非活动内存数量  (-a option)
- active : 活动内存数量  (-a option)

### swap

- si : 每秒从交换区写到内存的大小，由磁盘调入内存
- so : 每秒写入交换区的内存大小，由内存调入磁盘

注意：内存够用的时候，这2个值都是0，如果这2个值长期大于0时，系统性能会受到影响，磁盘IO和CPU资源都会被消耗.
有些人看到空闲内存（free）很少的或接近于0时，就认为内存不够用了，不能光看这一点，还要结合si和so，如果free很少，但是si和so也很少（大多时候是0），那么不用担心，系统性能这时不会受到影响的, 否则就需要加大内存.

### IO（现在的Linux版本块的大小为1kb）

报告每秒磁盘读取和写入的块的统计信息,如果你发现有巨大的 I/O 读写，最好使用 iotop 和 iostat 命令来查看.

- bi : 每秒从块设备读取的块数
- bo : 每秒写入块设备的块数

注意：随机磁盘读写的时候，这2个值越大（如超出1024k)，能看到CPU在IO等待的值也会越大

### system（系统）

- in: 每秒中断数，包括时钟中断
- cs: 每秒上下文切换数, 即kernel切换其正在运行进程的次数

注意：上面2个值越大，会看到由内核消耗的CPU时间会越大; cs或in的数值极高, 一般表示硬件设备的配置或运行有错误.

### CPU（以百分比表示）
- us : 用户进程执行时间百分比(user time)

    us的值比较高时，说明用户进程消耗的CPU时间多，但是如果长期超50%的使用，那么我们就该考虑优化程序算法或者进行加速

- sy: 内核系统进程执行时间百分比(system time)

    sy的值高时，说明系统内核消耗的CPU资源多，这并不是良性表现，我们应该检查原因

    经验: us+sy>80%即可能cpu资源不足

- wa: IO等待时间百分比

    wa的值高(> 20%)时，说明IO等待比较严重，这可能由于磁盘大量作随机访问造成，也有可能磁盘出现瓶颈（块操作）

- id: 空闲时间百分比

经验: 
1. 通用应用应该是系统50%的非空闲时间用于用户空间, 而另50%用于系统空间.
1. cpu密集型应用, 大部分时间应该花在用户空间.

### 磁盘(-d)
#### 读
- total ： 成功完成的总读取数
- merge ： 分组的读取数（生成一个 I/O）
- sectors ： 成功读取的分区
- ms ： 用于读取的毫秒
#### 写
- total ： 成功完成的总写入数
- merge ： 分组的写入数（生成一个 I/O）
- sectors ： 成功写入的分区
- ms ： 用于写入的毫秒
#### I/O
- cur ： 正在进行中的 I/O
- sec ： 用于 I/O 的秒数

> `vmstat -p /dev/sda1 1 10`可以分区模式输出

### slab(-m)
获取slab信息, 见`man vmstat`
